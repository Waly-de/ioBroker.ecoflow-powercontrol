{
  "common": {
    "name": "ecoflow-powercontrol",
    "title": "ioBroker EcoFlow PowerControl",
    "titleLang": {
      "de": "EcoFlow PowerControl",
      "en": "EcoFlow PowerControl"
    },
    "version": "0.1.17",
    "news": {
      "0.1.17": {
        "en": "Fix command button retriggering: test/import/reset states are reset after execution so repeated clicks work reliably",
        "de": "Fix für wiederholte Button-Klicks: Test/Import/Reset-States werden nach Ausführung zurückgesetzt, damit erneutes Auslösen zuverlässig funktioniert"
      },
      "0.1.16": {
        "en": "Fix auto-import restart loop, switch EcoFlow admin tab to ef* compatibility keys, and add reset-all settings button",
        "de": "Auto-Import-Reset-Schleife behoben, EcoFlow-Admin-Tab auf kompatible ef*-Keys umgestellt und Reset-Button für alle Einstellungen ergänzt"
      },
      "0.1.15": {
        "en": "Fix legacy script import parser for unresolved identifiers and align MQTT probe clientId/options closer to legacy behavior",
        "de": "Parser-Fix für Legacy-Script-Import bei undefinierten Bezeichnern und MQTT-Probe näher ans Legacy-Verhalten (clientId/Optionen) angepasst"
      },
      "0.1.14": {
        "en": "Add compatibility fallbacks for admin key layouts (efEmail/efPassword/efDevices/efLegacyScriptImport) and apply them to startup/import",
        "de": "Kompatibilitäts-Fallbacks für Admin-Key-Layouts ergänzt (efEmail/efPassword/efDevices/efLegacyScriptImport) und für Startup/Import aktiviert"
      },
      "0.1.13": {
        "en": "Read effective config from both runtime and instance native object; robust fallback for EcoFlow credentials",
        "de": "Effektive Konfiguration aus Runtime und Instanz-Native lesen; robuster Fallback für EcoFlow-Zugangsdaten"
      },
      "0.1.12": {
        "en": "Fix config read on some admin versions: normalize flat native keys (e.g. ecoflow.email) to nested objects",
        "de": "Fix fürs Konfig-Lesen bei manchen Admin-Versionen: flache Native-Keys (z.B. ecoflow.email) werden in verschachtelte Objekte normalisiert"
      },
      "0.1.11": {
        "en": "Auto-import legacy script on startup: paste script in admin, save, done – no button needed",
        "de": "Auto-Import von altem Script beim Start: Script in Admin einfügen, speichern, fertig – kein Button nötig"
      },
      "0.1.10": {
        "en": "Add startup diagnostics for EcoFlow config and auto-enable fallback when credentials are present",
        "de": "Startup-Diagnose für EcoFlow-Konfiguration ergänzt und Auto-Enable-Fallback bei vorhandenen Zugangsdaten aktiviert"
      },
      "0.1.9": {
        "en": "Improve EcoFlow connect reliability with MQTT variant probing and explicit system-log traces for test/import commands",
        "de": "EcoFlow-Verbindungszuverlässigkeit verbessert durch MQTT-Varianten-Probing und explizite System-Logs für Test/Import-Befehle"
      },
      "0.1.8": {
        "en": "Improve admin compatibility: test/import now run via command states; add import result state and robust command handling",
        "de": "Admin-Kompatibilität verbessert: Test/Import laufen über Command-States; Ergebnis-State und robuste Command-Verarbeitung ergänzt"
      },
      "0.1.7": {
        "en": "Fix EcoFlow connection handling according to legacy script and add old-script config import in admin",
        "de": "EcoFlow-Verbindungslogik am Legacy-Script ausgerichtet und Import alter Script-Konfiguration in Admin ergänzt"
      },
      "0.1.6": {
        "en": "Add detailed EcoFlow connection logging and admin test-connection button",
        "de": "Detailliertes EcoFlow-Verbindungslogging und Admin-Button zum Verbindungstest ergänzt"
      },
      "0.1.5": {
        "en": "Admin compatibility fix: EcoFlow credentials and device list are always visible in the EcoFlow tab",
        "de": "Admin-Kompatibilitätsfix: EcoFlow-Zugangsdaten und Geräteliste sind im EcoFlow-Tab immer sichtbar"
      },
      "0.1.4": {
        "en": "Fix EcoFlow tab visibility: remove panel wrapper and show credential fields/devices via direct hidden conditions",
        "de": "EcoFlow-Tab repariert: Panel-Wrapper entfernt und Zugangsdaten/Geräteliste über direkte hidden-Bedingungen eingeblendet"
      },
      "0.1.3": {
        "en": "Fix admin tables: add compatible table item definitions so Add button is shown for inverters, additional power and EcoFlow devices",
        "de": "Admin-Tabellen repariert: kompatible Tabellen-Definition ergänzt, damit der Add-Button bei Wechselrichtern, Zusatzleistung und EcoFlow-Geräten angezeigt wird"
      },
      "0.1.2": {
        "en": "Fix admin UI: replace header-type with staticText, use panels for reliable conditional display",
        "de": "Admin-UI repariert: header-Typ durch staticText ersetzt, Panels für zuverlässige bedingte Anzeige"
      },
      "0.1.1": {
        "en": "Fix admin UI: add i18n support and correct item key format so table Add buttons work",
        "de": "Admin-UI repariert: i18n aktiviert und Item-Keys korrigiert, Tabellen-Hinzufügen-Buttons funktionieren jetzt"
      },
      "0.1.0": {
        "en": "Initial release – generic inverter regulation with optional EcoFlow MQTT bridge",
        "de": "Erstveröffentlichung – generische Wechselrichterregelung mit optionaler EcoFlow MQTT-Brücke"
      }
    },
    "desc": {
      "en": "Generic solar inverter power regulation with optional EcoFlow MQTT bridge. Supports any inverter with configurable ioBroker state IDs.",
      "de": "Generische Solar-Wechselrichterregelung mit optionaler EcoFlow MQTT-Brücke. Unterstützt jeden Wechselrichter über konfigurierbare ioBroker State-IDs."
    },
    "authors": [
      "Markus Walber <markus@walber.de>"
    ],
    "enabled": true,
    "platform": "Javascript/Node.js",
    "mode": "daemon",
    "type": "energy",
    "allowInit": true,
    "connectionType": "cloud",
    "dataSource": "push",
    "adminUI": {
      "config": "json"
    },
    "dependencies": [
      {
        "js-controller": ">=5.0.0"
      }
    ],
    "globalDependencies": [],
    "keywords": [
      "ecoflow",
      "powerstream",
      "inverter",
      "solar",
      "regulation",
      "smartmeter"
    ]
  },
  "native": {
    "regulation": {
      "enabled": true,
      "smartmeterStateId": "",
      "smartmeterTimeoutMin": 4,
      "smartmeterFallbackPower": 150,
      "intervalSec": 15,
      "basePowerOffset": 30,
      "minValueMin": 2,
      "minValueAg": 0,
      "multiPsMode": 0,
      "serialReverse": false,
      "zusatzpowerOffset": 10,
      "historyAdapter": "history",
      "historyInstance": "0"
    },
    "inverters": [],
    "additionalPower": [],
    "excessCharge": {
      "enabled": false,
      "powerStateId": "",
      "batSocStateId": "",
      "actualPowerStateId": "",
      "switchStateId": "",
      "switchOnValue": "true",
      "switchOffValue": "false",
      "switchMinMin": 5,
      "maxPower": 2000,
      "offsetPower": 0,
      "startPower": 50,
      "stopPower": 0,
      "startDurationMin": 1,
      "minRegulatePauseMin": 1,
      "regulateSteps": 100,
      "batSocMax": 95,
      "batSocOff": 100
    },
    "ecoflow": {
      "enabled": false,
      "email": "",
      "password": "",
      "reconnectMin": 30,
      "devices": [],
      "legacyScriptImport": ""
    },
    "efEnabled": false,
    "efEmail": "",
    "efPassword": "",
    "efReconnectMin": 30,
    "efDevices": [],
    "efLegacyScriptImport": "",
    "advanced": {
      "debug": false,
      "mlog": false,
      "avgPeriodMs": 15000
    }
  },
  "objects": [],
  "instanceObjects": [
    {
      "_id": "info",
      "type": "channel",
      "common": {
        "name": "Adapter Information"
      },
      "native": {}
    },
    {
      "_id": "info.connection",
      "type": "state",
      "common": {
        "name": "EcoFlow MQTT connection",
        "role": "indicator.connected",
        "type": "boolean",
        "read": true,
        "write": false,
        "def": false
      },
      "native": {}
    },
    {
      "_id": "regulation",
      "type": "channel",
      "common": {
        "name": "Regulation"
      },
      "native": {}
    },
    {
      "_id": "regulation.enabled",
      "type": "state",
      "common": {
        "name": "Regulation enabled",
        "role": "switch",
        "type": "boolean",
        "read": true,
        "write": true,
        "def": true
      },
      "native": {}
    },
    {
      "_id": "regulation.gridPower",
      "type": "state",
      "common": {
        "name": "Grid power (from smart meter)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.realPower",
      "type": "state",
      "common": {
        "name": "Real power demand (grid + all feed-in)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.totalPV",
      "type": "state",
      "common": {
        "name": "Total PV power across all inverters",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.excessPower",
      "type": "state",
      "common": {
        "name": "Excess solar power available",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.lowestValue",
      "type": "state",
      "common": {
        "name": "Lowest real power in measurement window",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.additionalPowerSum",
      "type": "state",
      "common": {
        "name": "Sum of all additional power sources (feed-in)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.additionalPVSum",
      "type": "state",
      "common": {
        "name": "Sum of all additional PV sources",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "inverters",
      "type": "channel",
      "common": {
        "name": "Inverters"
      },
      "native": {}
    }
  ]
}

{
  "common": {
    "name": "ecoflow-powercontrol",
    "title": "ioBroker EcoFlow PowerControl",
    "titleLang": {
      "de": "EcoFlow PowerControl",
      "en": "EcoFlow PowerControl"
    },
    "version": "0.1.46",
    "news": {
      "0.1.38": {
        "en": "Fix config normalization: empty flat keys no longer overwrite non-empty nested values (affects regulation and other tabs), plus regulation snapshot diagnostics",
        "de": "Konfig-Normalisierung korrigiert: leere flache Keys überschreiben keine nicht-leeren verschachtelten Werte mehr (betrifft Regelung und weitere Tabs), plus Regulation-Snapshot-Diagnose"
      },
      "0.1.37": {
        "en": "Fix strict smartmeter selection to prioritize runtime admin value over native fallback and log runtime/native source values",
        "de": "Strikte Smartmeter-Auswahl korrigiert: Runtime-Adminwert hat jetzt Vorrang vor Native-Fallback; Runtime/Native-Quellwerte werden geloggt"
      },
      "0.1.36": {
        "en": "Enforce strict smartmeter source: only regulation.smartmeterStateId from adapter config is used; legacy SmartmeterID keys are ignored",
        "de": "Strikte Smartmeter-Quelle erzwungen: Es wird nur regulation.smartmeterStateId aus der Adapter-Konfiguration verwendet; Legacy-SmartmeterID-Keys werden ignoriert"
      },
      "0.1.35": {
        "en": "Fix smartmeter source priority: always prefer regulation.smartmeterStateId from admin config; use legacy SmartmeterID keys only as fallback",
        "de": "Priorität der Smartmeter-Quelle korrigiert: immer regulation.smartmeterStateId aus der Admin-Konfiguration bevorzugen; Legacy-SmartmeterID-Keys nur noch als Fallback"
      },
      "0.1.34": {
        "en": "Expand smartmeter ID resolution to legacy key variants and log all runtime/native source candidates for transparent diagnostics",
        "de": "Smartmeter-ID-Auflösung auf Legacy-Key-Varianten erweitert und alle Runtime/Native-Quellkandidaten transparent geloggt"
      },
      "0.1.33": {
        "en": "Resolve regulation.smartmeterStateId by checking runtime/native candidates and selecting the freshest available state timestamp to avoid stale imported IDs",
        "de": "regulation.smartmeterStateId wird über Runtime/Native-Kandidaten aufgelöst und nach dem neuesten verfügbaren State-Zeitstempel ausgewählt, um veraltete importierte IDs zu vermeiden"
      },
      "0.1.32": {
        "en": "Run own/foreign subscriptions in background, refresh regulation.enabled directly in loop, and add history setup timeout guard to keep startup non-blocking",
        "de": "Eigene/fremde Subscriptions im Hintergrund ausgeführt, regulation.enabled direkt in der Schleife aktualisiert und History-Setup mit Timeout abgesichert, damit Startup nicht blockiert"
      },
      "0.1.31": {
        "en": "Guard own-state subscriptions with per-state timeout and continue startup to avoid stalls at subscribe own states",
        "de": "Eigene State-Subscriptions mit Timeout pro State abgesichert und Startup-Fortsetzung erzwungen, um Hänger bei 'subscribe own states' zu vermeiden"
      },
      "0.1.30": {
        "en": "Add detailed onReady breadcrumb logs and fatal startup error logging to pinpoint initialization stalls",
        "de": "Detaillierte onReady-Breadcrumb-Logs und fatale Startup-Fehlerausgabe ergänzt, um Initialisierungs-Blockaden exakt zu lokalisieren"
      },
      "0.1.29": {
        "en": "Make EcoFlow MQTT startup non-blocking with timeout guard so adapter initialization continues and regulation/realPower always start",
        "de": "EcoFlow-MQTT-Start mit Timeout-Schutz nicht-blockierend gemacht, damit Adapter-Initialisierung weiterläuft und Regelung/realPower immer starten"
      },
      "0.1.28": {
        "en": "Guard foreign state subscriptions with object checks and timeout to prevent startup blocking; add subscription phase logs",
        "de": "Foreign-State-Subscriptions mit Objekt-Checks und Timeout abgesichert, um Start-Blockaden zu vermeiden; zusätzliche Logs für die Subscription-Phase ergänzt"
      },
      "0.1.27": {
        "en": "Add extensive smartmeter diagnostics (raw/normalized ID, object/state checks, watcher ticks, realPower source and write logs)",
        "de": "Umfangreiche Smartmeter-Diagnose ergänzt (raw/normalisierte ID, Objekt/State-Checks, Watcher-Ticks sowie realPower-Quelle und Schreib-Logs)"
      },
      "0.1.26": {
        "en": "Hotfix: restore missing method declaration for realPower watcher introduced in 0.1.25",
        "de": "Hotfix: fehlende Methoden-Deklaration für den in 0.1.25 eingeführten realPower-Watcher wiederhergestellt"
      },
      "0.1.25": {
        "en": "Add periodic realPower watcher independent of state-change subscriptions, read smartmeter value at execution time, and align LastRealPower handling with legacy script",
        "de": "Periodischen realPower-Watcher unabhängig von State-Change-Subscriptions ergänzt, Smartmeterwert zur Ausführungszeit gelesen und LastRealPower-Verhalten ans Legacy-Script angeglichen"
      },
      "0.1.24": {
        "en": "Normalize Smartmeter state IDs from config/import snippets, add subscription diagnostics, and fix realPower first-value handling for negative readings",
        "de": "Smartmeter-State-IDs aus Konfig/Import-Snippets normalisiert, Subscription-Diagnose ergänzt und realPower-Erstwertbehandlung bei negativen Werten korrigiert"
      },
      "0.1.23": {
        "en": "Improve legacy import payload for multiline scripts, add tolerant SmartmeterID mapping, and initialize realPower at startup from smartmeter",
        "de": "Legacy-Import-Payload für mehrzeilige Skripte verbessert, SmartmeterID-Mapping toleranter gemacht und realPower beim Start direkt vom Smartmeter initialisiert"
      },
      "0.1.22": {
        "en": "Enable common.messagebox so admin sendTo commands are delivered to adapter onMessage",
        "de": "common.messagebox aktiviert, damit Admin-sendTo-Kommandos im Adapter über onMessage ankommen"
      },
      "0.1.21": {
        "en": "Switch admin test/import/reset buttons to sendTo with backend result mapping, add explicit command-received logs, and mirror outcomes to commands.lastResult",
        "de": "Admin-Buttons für Test/Import/Reset auf sendTo mit Ergebnis-Mapping umgestellt, explizite Logs bei Kommandoeingang ergänzt und Ergebnisse nach commands.lastResult gespiegelt"
      },
      "0.1.20": {
        "en": "Fix admin command execution reliability for test/import/reset, add live command result display in admin, and stabilize reset sequencing",
        "de": "Zuverlässigkeit der Admin-Befehle für Test/Import/Reset verbessert, Live-Ergebnisanzeige in der Admin ergänzt und Reset-Ablauf stabilisiert"
      },
      "0.1.19": {
        "en": "Hard reset now removes full adapter object/state tree and then restores default native config for a clean start",
        "de": "Hard-Reset löscht jetzt den kompletten Objekt-/State-Baum des Adapters und stellt danach die Default-Native-Konfiguration für einen sauberen Neustart wieder her"
      },
      "0.1.18": {
        "en": "Fix EcoFlow admin field visibility by binding back to ecoflow.* keys, prevent empty device arrays from overriding configured devices, and start MQTT only when devices exist",
        "de": "Sichtbarkeit der EcoFlow-Adminfelder durch Rückbindung an ecoflow.*-Keys behoben, Überschreiben konfigurierter Geräte durch leere Arrays verhindert und MQTT-Start nur noch mit vorhandenen Geräten"
      },
      "0.1.17": {
        "en": "Fix command button retriggering: test/import/reset states are reset after execution so repeated clicks work reliably",
        "de": "Fix für wiederholte Button-Klicks: Test/Import/Reset-States werden nach Ausführung zurückgesetzt, damit erneutes Auslösen zuverlässig funktioniert"
      },
      "0.1.16": {
        "en": "Fix auto-import restart loop, switch EcoFlow admin tab to ef* compatibility keys, and add reset-all settings button",
        "de": "Auto-Import-Reset-Schleife behoben, EcoFlow-Admin-Tab auf kompatible ef*-Keys umgestellt und Reset-Button für alle Einstellungen ergänzt"
      },
      "0.1.15": {
        "en": "Fix legacy script import parser for unresolved identifiers and align MQTT probe clientId/options closer to legacy behavior",
        "de": "Parser-Fix für Legacy-Script-Import bei undefinierten Bezeichnern und MQTT-Probe näher ans Legacy-Verhalten (clientId/Optionen) angepasst"
      },
      "0.1.14": {
        "en": "Add compatibility fallbacks for admin key layouts (efEmail/efPassword/efDevices/efLegacyScriptImport) and apply them to startup/import",
        "de": "Kompatibilitäts-Fallbacks für Admin-Key-Layouts ergänzt (efEmail/efPassword/efDevices/efLegacyScriptImport) und für Startup/Import aktiviert"
      },
      "0.1.13": {
        "en": "Read effective config from both runtime and instance native object; robust fallback for EcoFlow credentials",
        "de": "Effektive Konfiguration aus Runtime und Instanz-Native lesen; robuster Fallback für EcoFlow-Zugangsdaten"
      },
      "0.1.12": {
        "en": "Fix config read on some admin versions: normalize flat native keys (e.g. ecoflow.email) to nested objects",
        "de": "Fix fürs Konfig-Lesen bei manchen Admin-Versionen: flache Native-Keys (z.B. ecoflow.email) werden in verschachtelte Objekte normalisiert"
      },
      "0.1.11": {
        "en": "Auto-import legacy script on startup: paste script in admin, save, done – no button needed",
        "de": "Auto-Import von altem Script beim Start: Script in Admin einfügen, speichern, fertig – kein Button nötig"
      },
      "0.1.10": {
        "en": "Add startup diagnostics for EcoFlow config and auto-enable fallback when credentials are present",
        "de": "Startup-Diagnose für EcoFlow-Konfiguration ergänzt und Auto-Enable-Fallback bei vorhandenen Zugangsdaten aktiviert"
      },
      "0.1.9": {
        "en": "Improve EcoFlow connect reliability with MQTT variant probing and explicit system-log traces for test/import commands",
        "de": "EcoFlow-Verbindungszuverlässigkeit verbessert durch MQTT-Varianten-Probing und explizite System-Logs für Test/Import-Befehle"
      },
      "0.1.8": {
        "en": "Improve admin compatibility: test/import now run via command states; add import result state and robust command handling",
        "de": "Admin-Kompatibilität verbessert: Test/Import laufen über Command-States; Ergebnis-State und robuste Command-Verarbeitung ergänzt"
      },
      "0.1.7": {
        "en": "Fix EcoFlow connection handling according to legacy script and add old-script config import in admin",
        "de": "EcoFlow-Verbindungslogik am Legacy-Script ausgerichtet und Import alter Script-Konfiguration in Admin ergänzt"
      },
      "0.1.6": {
        "en": "Add detailed EcoFlow connection logging and admin test-connection button",
        "de": "Detailliertes EcoFlow-Verbindungslogging und Admin-Button zum Verbindungstest ergänzt"
      },
      "0.1.5": {
        "en": "Admin compatibility fix: EcoFlow credentials and device list are always visible in the EcoFlow tab",
        "de": "Admin-Kompatibilitätsfix: EcoFlow-Zugangsdaten und Geräteliste sind im EcoFlow-Tab immer sichtbar"
      },
      "0.1.4": {
        "en": "Fix EcoFlow tab visibility: remove panel wrapper and show credential fields/devices via direct hidden conditions",
        "de": "EcoFlow-Tab repariert: Panel-Wrapper entfernt und Zugangsdaten/Geräteliste über direkte hidden-Bedingungen eingeblendet"
      },
      "0.1.3": {
        "en": "Fix admin tables: add compatible table item definitions so Add button is shown for inverters, additional power and EcoFlow devices",
        "de": "Admin-Tabellen repariert: kompatible Tabellen-Definition ergänzt, damit der Add-Button bei Wechselrichtern, Zusatzleistung und EcoFlow-Geräten angezeigt wird"
      },
      "0.1.2": {
        "en": "Fix admin UI: replace header-type with staticText, use panels for reliable conditional display",
        "de": "Admin-UI repariert: header-Typ durch staticText ersetzt, Panels für zuverlässige bedingte Anzeige"
      },
      "0.1.1": {
        "en": "Fix admin UI: add i18n support and correct item key format so table Add buttons work",
        "de": "Admin-UI repariert: i18n aktiviert und Item-Keys korrigiert, Tabellen-Hinzufügen-Buttons funktionieren jetzt"
      },
      "0.1.0": {
        "en": "Initial release – generic inverter regulation with optional EcoFlow MQTT bridge",
        "de": "Erstveröffentlichung – generische Wechselrichterregelung mit optionaler EcoFlow MQTT-Brücke"
      },
      "0.1.39": {
        "en": "Dump raw this.config and instanceObj.native for smartmeter debug",
        "de": "Raw-Config-Dump für Smartmeter-Debugging"
      },
      "0.1.40": {
        "en": "Fix: read smartmeterStateId from regSmStateId element key",
        "de": "Fix: Smartmeter-ID aus regSmStateId-Key lesen (ioBroker-Admin-Kompatibilität)"
      },
      "0.1.41": {
        "en": "Fix reset (regSmStateId cleared), fix lastCut applied to all inverters, fix invOutputWatts timeout 90->50s",
        "de": "Fix Reset (regSmStateId wird geleert), lastCut-Verteilung auf alle WR behoben, invOutputWatts Timeout 90->50s"
      }
    },
    "desc": {
      "en": "Generic solar inverter power regulation with optional EcoFlow MQTT bridge. Supports any inverter with configurable ioBroker state IDs.",
      "de": "Generische Solar-Wechselrichterregelung mit optionaler EcoFlow MQTT-Brücke. Unterstützt jeden Wechselrichter über konfigurierbare ioBroker State-IDs."
    },
    "authors": [
      "Markus Walber <markus@walber.de>"
    ],
    "enabled": true,
    "platform": "Javascript/Node.js",
    "mode": "daemon",
    "messagebox": true,
    "type": "energy",
    "allowInit": true,
    "connectionType": "cloud",
    "dataSource": "push",
    "adminUI": {
      "config": "json"
    },
    "dependencies": [
      {
        "js-controller": ">=5.0.0"
      }
    ],
    "globalDependencies": [],
    "keywords": [
      "ecoflow",
      "powerstream",
      "inverter",
      "solar",
      "regulation",
      "smartmeter"
    ]
  },
  "native": {
    "regulation": {
      "enabled": true,
      "smartmeterStateId": "",
      "smartmeterTimeoutMin": 4,
      "smartmeterFallbackPower": 150,
      "intervalSec": 15,
      "basePowerOffset": 30,
      "minValueMin": 2,
      "minValueAg": 0,
      "multiPsMode": 0,
      "serialReverse": false,
      "zusatzpowerOffset": 10,
      "historyAdapter": "history",
      "historyInstance": "0"
    },
    "inverters": [],
    "additionalPower": [],
    "excessCharge": {
      "enabled": false,
      "powerStateId": "",
      "batSocStateId": "",
      "actualPowerStateId": "",
      "switchStateId": "",
      "switchOnValue": "true",
      "switchOffValue": "false",
      "switchMinMin": 5,
      "maxPower": 2000,
      "offsetPower": 0,
      "startPower": 50,
      "stopPower": 0,
      "startDurationMin": 1,
      "minRegulatePauseMin": 1,
      "regulateSteps": 100,
      "batSocMax": 95,
      "batSocOff": 100
    },
    "ecoflow": {
      "enabled": false,
      "email": "",
      "password": "",
      "reconnectMin": 30,
      "devices": [],
      "legacyScriptImport": ""
    },
    "efEnabled": false,
    "efEmail": "",
    "efPassword": "",
    "efReconnectMin": 30,
    "efDevices": [],
    "efLegacyScriptImport": "",
    "advanced": {
      "debug": false,
      "mlog": false,
      "avgPeriodMs": 15000
    }
  },
  "objects": [],
  "instanceObjects": [
    {
      "_id": "info",
      "type": "channel",
      "common": {
        "name": "Adapter Information"
      },
      "native": {}
    },
    {
      "_id": "info.connection",
      "type": "state",
      "common": {
        "name": "EcoFlow MQTT connection",
        "role": "indicator.connected",
        "type": "boolean",
        "read": true,
        "write": false,
        "def": false
      },
      "native": {}
    },
    {
      "_id": "regulation",
      "type": "channel",
      "common": {
        "name": "Regulation"
      },
      "native": {}
    },
    {
      "_id": "regulation.enabled",
      "type": "state",
      "common": {
        "name": "Regulation enabled",
        "role": "switch",
        "type": "boolean",
        "read": true,
        "write": true,
        "def": true
      },
      "native": {}
    },
    {
      "_id": "regulation.gridPower",
      "type": "state",
      "common": {
        "name": "Grid power (from smart meter)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.realPower",
      "type": "state",
      "common": {
        "name": "Real power demand (grid + all feed-in)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.totalPV",
      "type": "state",
      "common": {
        "name": "Total PV power across all inverters",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.excessPower",
      "type": "state",
      "common": {
        "name": "Excess solar power available",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.lowestValue",
      "type": "state",
      "common": {
        "name": "Lowest real power in measurement window",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.additionalPowerSum",
      "type": "state",
      "common": {
        "name": "Sum of all additional power sources (feed-in)",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "regulation.additionalPVSum",
      "type": "state",
      "common": {
        "name": "Sum of all additional PV sources",
        "role": "value.power",
        "type": "number",
        "unit": "W",
        "read": true,
        "write": false,
        "def": 0
      },
      "native": {}
    },
    {
      "_id": "commands",
      "type": "channel",
      "common": {
        "name": "Admin Commands"
      },
      "native": {}
    },
    {
      "_id": "commands.testConnection",
      "type": "state",
      "common": {
        "name": "Trigger EcoFlow connection test",
        "type": "string",
        "role": "state",
        "read": true,
        "write": true,
        "def": ""
      },
      "native": {}
    },
    {
      "_id": "commands.importLegacyScript",
      "type": "state",
      "common": {
        "name": "Trigger import from legacy script",
        "type": "string",
        "role": "state",
        "read": true,
        "write": true,
        "def": ""
      },
      "native": {}
    },
    {
      "_id": "commands.lastResult",
      "type": "state",
      "common": {
        "name": "Last command result",
        "type": "string",
        "role": "text",
        "read": true,
        "write": false,
        "def": ""
      },
      "native": {}
    },
    {
      "_id": "commands.resetAllSettings",
      "type": "state",
      "common": {
        "name": "Reset all adapter settings to defaults",
        "type": "boolean",
        "role": "button",
        "read": true,
        "write": true,
        "def": false
      },
      "native": {}
    },
    {
      "_id": "inverters",
      "type": "channel",
      "common": {
        "name": "Inverters"
      },
      "native": {}
    }
  ],
  "version": "0.1.46"
}
